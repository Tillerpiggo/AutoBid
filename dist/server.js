(()=>{"use strict";var e={422:(e,o,t)=>{Object.defineProperty(o,"__esModule",{value:!0});const n=t(185),r=new n.Schema({email:{type:String,required:!0,unique:!0},loginCode:{type:String,required:!0},loginCodeExpires:{type:Date},friends:[{name:String,birthday:Date}]});o.default=n.model("User",r)},505:function(e,o,t){var n=this&&this.__awaiter||function(e,o,t,n){return new(t||(t=Promise))((function(r,i){function s(e){try{l(n.next(e))}catch(e){i(e)}}function a(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){var o;e.done?r(e.value):(o=e.value,o instanceof t?o:new t((function(e){e(o)}))).then(s,a)}l((n=n.apply(e,o||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(o,"__esModule",{value:!0});const i=r(t(860)),s=r(t(185)),a=r(t(422)),l=t(294);r(t(142)).default.config();const c=(0,i.default)();s.default.connect("mongodb://localhost/newsletter_app"),console.log(process.env.MAILGUN_API_KEY);const d=new l.NodeMailgun;console.log(process.env.MAILGUN_API_KEY),d.apiKey="d5f2b3f5e1354af28393cc0cc7e234c7-ee16bf1a-38bc24b4",d.domain="sandbox8b5c461a52ed44469758906f83cd1231.mailgun.org",d.fromEmail="ideas@autigift.com",d.fromTitle="Autogift Inc",d.init(),c.use(i.default.json()),c.get("/",((e,o)=>{o.send("Hello, world!")}));const u=process.env.PORT||3e3;c.listen(u,(()=>{console.log(`Server is listening on port ${u}`)})),c.post("/register",((e,o)=>n(void 0,void 0,void 0,(function*(){const{email:t}=e.body;if(yield a.default.findOne({email:t}))return o.status(400).send({error:"User with this email already exists"});const n=Math.floor(1e5+9e5*Math.random()),r=new a.default({email:t,loginCode:n,loginCodeExpires:Date.now()+9e5});yield r.save(),process.env.MAILGUN_FROM_EMAIL,d.send(t,"Your Login Code",`<h1>Your login code is ${n}</h1>`).then((()=>{o.send({message:"User registered, check your email for your login code"})})).catch((e=>{console.error(e),o.status(500).send({error:"Failed to send email"})}))}))))},142:e=>{e.exports=require("dotenv")},860:e=>{e.exports=require("express")},185:e=>{e.exports=require("mongoose")},294:e=>{e.exports=require("ts-mailgun")}},o={};!function t(n){var r=o[n];if(void 0!==r)return r.exports;var i=o[n]={exports:{}};return e[n].call(i.exports,i,i.exports,t),i.exports}(505)})();